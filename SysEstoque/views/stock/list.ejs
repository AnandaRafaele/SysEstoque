<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-lg-6">
           Estoque
          </div>
          <div class="col-lg-6 text-right">
            <button type="text" class="btn btn-icons btn-rounded btn-outline-primary" data-toggle="modal" data-target="#modalAdd"><i
                class="mdi mdi-plus"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Produto</th>
                <th>Em estoque</th>
                <th>Valor Unitário</th>
                <th>Valor Total</th>
                <th>QNTD Mínima</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% stocks.forEach(function(stock, index){ %>
              <tr>
                <td>
                  <%= index += 1%>
                </td>
                <td>
                  <%= stock.product.name %>
                </td>
                <td>
                  <%= stock.quantity %>
                </td>
                <td>
                  <%= stock.valUnit %>
                </td>
                <td>
                  <%= stock.valTotal %>
                </td>
                <td>
                  <%= stock.minQuantity %>
                </td>
                <td>
                  <button onclick="editStock('<%= stock.id %>', '<%= stock.product.name %>',
                    '<%= stock.quantity %>', '<%= stock.valUnit %>', '<%= stock.valTotal %>',
                    '<%= stock.minQuantity %>')" 
                    class="btn btn-icons btn-rounded btn-outline-warning" data-toggle="modal" data-target="#modalEdit"
                    data-product="<%= stock.product.name%>"
                    data-quantity="<%= stock.quantity%>"
                    data-valUnit="<%= stock.valUnit%>"
                    data-valTotal="<%= stock.valTotal%>"
                    data-minQuantity="<%= stock.minQuantity%>"
                    data-id="<%= stock.id%>"
                    ><i class="mdi mdi-pencil"></i></button>
                  
                  <button class="btn btn-icons btn-rounded btn-outline-danger" type="button" onClick="deleteStock('<%= stock.id %>')"><i
                    class="mdi mdi-delete"></i></button>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal de Cadastro  -->
  <div class="modal fade" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Cadastro de Estoque</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="forms-sample" method="POST" action="/stock/create">
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addProduct">Produto</label>
                  <select class="form-control" id="addProduct" name="product">
                    <% products.forEach(function(product){ %>
                      <option value="<%= product.id %>">
                          <%= product.name %>
                        </option>
                    <% }) %>
                    </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addQuantity">Quantidade</label>
                  <input type="number" class="form-control" id="addQuantity" name="quantity" placeholder="Ex.: 150">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addValUnit">Valor Unitário</label>
                  <input type="text" class="form-control" name="valUnit" id="addValUnit" onblur="calcular();" placeholder="Ex.: 500,00">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addMinQuantity">Quantidade mínima</label>
                  <input type="number" class="form-control" name="minQuantity" id="addMinQuantity" placeholder="Ex.: 100,00">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="addValTotal">Valor Total</label>
                  <input type="text" class="form-control" name="valTotal" id="addValTotal" placeholder="Valor total">
                </div>
              </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button type="submit" class="btn btn-primary">Cadastrar</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Fim Modal de Cadastro  -->
  
  <!-- Modal de Alteração  -->
  <div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edição de Usuário</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="forms-sample" method="POST" action="" id="editForm">
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="editName">Nome</label>
                  <input type="text" class="form-control" id="editName" name="name" placeholder="Digite seu nome">
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="editPhone">Telefone</label>
                  <input type="tel" class="form-control" name="phoneNumber" id="editPhone" placeholder="Digite seu telefone">
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="editEmail">Email</label>
              <input type="email" class="form-control" name="email" id="editEmail" placeholder="Digite seu email">
            </div>
            <div class="row">
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="editStatus">Status</label>
                  <select class="form-control" id="editStatus" name="status">
                    <option value="activated" selected>Ativo</option>
                    <option value="disabled">Pendente</option>
                    <option value="blocked">Bloqueado</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <label for="editLevel">Nível de Acesso</label>
                  <select class="form-control" id="editLevel" name="accessLevel">
                    <option value="employee" selected>Empregado</option>
                    <option value="administrator">Administrador</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
              <button type="submit" id="editBtn" class="btn btn-primary">Alterar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/jquery-3.3.1.js"></script>
  <script>

    function calcular() {
      var n1 = $('#addQuantity').val();
      var n2 = $('#addValUnit').val();
      if (n2.match(/,/)) {
        n2 = n2.replace(",", ".");
      }
      soma = parseFloat(parseInt(n1) * parseFloat(n2).toFixed(2)).toFixed(2);
      console.log(soma)
      $('#addValTotal').val(soma);
    }

    function deleteStock(id) {
      var del = confirm('Deseja excluir usuário?')
      if (del == true) {
        $.post('/stock/delete/' + id, id, function () { 
          alert("Usuário excluido com sucesso");
          window.location.reload()
        });
      }
    }
  
    function editStock(id, name, email, phoneNumber, status, accessLevel){
      $('#editName').val(name);
      $('#editEmail').val(email);
      $('#editPhone').val(phoneNumber);
      $('#editStatus').val(status);
      $('#editLevel').val(accessLevel);
  
      $('#editBtn').click(function(){
        document.getElementById('editForm').setAttribute("action", "/stock/update/"+id)
      })
    }
  </script>